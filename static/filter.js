let filterSos = {
	"<0.1": [
		9.66139663398867e-11, 1.932279326797734e-10, 9.66139663398867e-11, 1.0, -1.9884180173746582, 0.9884572678187328,
		1.0, 2.0, 1.0, 1.0, -1.9951632412838627, 0.9952026248755107,
	],
	"<0.5": [
		5.845142433144487e-08, 1.1690284866288973e-07, 5.845142433144487e-08, 1.0, -1.9426382305401135, 0.9435972784703671,
		1.0, 2.0, 1.0, 1.0, -1.975269634851873, 0.9762447923594398,
	],
	"<1": [
		8.984861463970637e-07, 1.7969722927941275e-06, 8.984861463970637e-07, 1.0, -1.8866095826215064, 0.8903397362840242,
		1.0, 2.0, 1.0, 1.0, -1.9492159580258417, 0.9530698953278909,
	],
	"0.01-0.05": [
		2.485502791125394e-12, 4.971005582250788e-12, 2.485502791125394e-12, 1.0, -1.9966292404945967, 0.9966344603016817,
		1.0, 2.0, 1.0, 1.0, -1.998404815071408, 0.9984141196742972,
		1.0, -2.0, 1.0, 1.0, -1.9987273521934938, 0.9987280969210308,
		1.0, -2.0, 1.0, 1.0, -1.9996632020957417, 0.9996636204495915,
	],
	"0.01-0.5": [
		5.3957313942191774e-08, 1.0791462788438355e-07, 5.3957313942191774e-08, 1.0, -1.944927388427801, 0.9458228130395433,
		1.0, 2.0, 1.0, 1.0, -1.9762055391576898, 0.9771704893890084,
		1.0, -2.0, 1.0, 1.0, -1.9988058813902703, 0.998806304463896,
		1.0, -2.0, 1.0, 1.0, -1.9995326667119366, 0.999533065766906,
	],
	"0.1-1": [
		5.942099795722209e-07, 1.1884199591444418e-06, 5.942099795722209e-07, 1.0, -1.9101440968486803, 0.9127481008110673,
		1.0, 2.0, 1.0, 1.0, -1.9578682726772445, 0.9615804791238562,
		1.0, -2.0, 1.0, 1.0, -1.9867979358110195, 0.9868547986435714,
		1.0, -2.0, 1.0, 1.0, -1.995880114265975, 0.9959211961123793,
	],
	"1-3": [
		1.3293728898752897e-05, 2.6587457797505794e-05, 1.3293728898752897e-05, 1.0, -1.8463121662192674, 0.8647118366045192,
		1.0, 2.0, 1.0, 1.0, -1.9096196650466386, 0.916429541365672,
		1.0, -2.0, 1.0, 1.0, -1.899323119536047, 0.9316037802673618,
		1.0, -2.0, 1.0, 1.0, -1.9710289923605038, 0.9751617932342163,
	],
	"3-5": [
		1.3293728898752887e-05, 2.6587457797505774e-05, 1.3293728898752887e-05, 1.0, -1.8120729698701945, 0.8799498227213426,
		1.0, 2.0, 1.0, 1.0, -1.8547735361751154, 0.9005598403125025,
		1.0, -2.0, 1.0, 1.0, -1.850960915199926, 0.9427348977466249,
		1.0, -2.0, 1.0, 1.0, -1.9275919862486772, 0.9636478029197343,
	],
	"5-7": [
		1.3293728898752912e-05, 2.6587457797505824e-05, 1.3293728898752912e-05, 1.0, -1.7371568496011391, 0.8837456590837429,
		1.0, 2.0, 1.0, 1.0, -1.7827759713553135, 0.8966917842114747,
		1.0, -2.0, 1.0, 1.0, -1.7655807366377267, 0.946410331594198,
		1.0, -2.0, 1.0, 1.0, -1.8615829179089913, 0.959905426453889,
	],
	"7-9": [
		1.3293728898752905e-05, 2.658745779750581e-05, 1.3293728898752905e-05, 1.0, -1.6327490553137103, 0.8855949921876636,
		1.0, 2.0, 1.0, 1.0, -1.6847586372614565, 0.8948192783649139,
		1.0, -2.0, 1.0, 1.0, -1.650424199423055, 0.948295314659584,
		1.0, -2.0, 1.0, 1.0, -1.7681476706270365, 0.9579973652779387,
	],
	"9-11": [
		1.3293728898752892e-05, 2.6587457797505784e-05, 1.3293728898752892e-05, 1.0, -1.501779773134056, 0.8867290252274398,
		1.0, 2.0, 1.0, 1.0, -1.5609837129648803, 0.8936748987433787,
		1.0, -2.0, 1.0, 1.0, -1.5084337228189424, 0.9494733870421532,
		1.0, -2.0, 1.0, 1.0, -1.6476334421879837, 0.9568087166501725,
	],
};

function sosfilt(sos, x) {
	// Modifies x.
	let n_sections = sos.length/6;
	let zi = new Array(n_sections*2).fill(0);
	for (let n = 0; n < x.length; n++) {
		for (let s = 0; s < n_sections; s++) {
			let x_n = x[n];
			x[n] = sos[s*6 + 0] * x_n + zi[s*2 + 0];
			zi[s*2 + 0] = sos[s*6 + 1] * x_n - sos[s*6 + 4] * x[n] + zi[s*2 + 1];
			zi[s*2 + 1] = sos[s*6 + 2] * x_n - sos[s*6 + 5] * x[n];
		}
	}
	return x;
}

function sosfiltfilt(sos, x) {
	// Modifies x.
	// Apply filter twice (once forwards and once backwards) to avoid phase shift.
	sosfilt(sos, x);
	x.reverse();
	sosfilt(sos, x);
	x.reverse();
}

function detrend(x) {
	// Modifies x.
	let x0 = x[0];
	let x1 = x[x.length - 1];
	for (let n = 0; n < x.length; n++) {
		x[n] = x[n] - (x0 + (x1 - x0)*n/(x.length - 1));
	}
	return x;
}
